<!-- Task Package Start Node HTML -->
<script type="text/javascript">
    // Isolate this code
    (function () {
        'use strict'

        const nodeLabel = 'tp-start'

        RED.nodes.registerType(nodeLabel, {
            category: 'Task Package',
            color: '#E57373',
            defaults: {
                name: { value: '' },
                auto_transition: { value: false }
            },
            inputs: 1,
            outputs: 1,
            outputLabels: ['Task flow'],
            icon: 'tp.svg',
            paletteLabel: 'start',
            label: function () { 
                return this.name || 'Start'
            }
        })

    })()
</script>

<script type="text/html" data-template-name="tp-start">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Task Package Start">
    </div>
    
    <div class="form-row">
        <label for="node-input-auto_transition"><i class="fa fa-forward"></i> Auto Transition</label>
        <input type="checkbox" id="node-input-auto_transition" style="display: inline-block; width: auto; vertical-align: baseline;">
        <label for="node-input-auto_transition" style="width: auto; margin-left: 5px;">Automatically transition to 'ongoing' status</label>
    </div>
    

</script>

<script type="text/html" data-help-name="tp-start">
    <p>Updates task package status to 'started' in the database. Should be wired after tp-create node and any custom validation logic.</p>
    
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>tp_data <span class="property-type">object</span></dt>
        <dd>Task package data object containing tpc_id and other task information.</dd>
    </dl>
    
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>tp_data <span class="property-type">object</span></dt>
        <dd>Complete task package data including ID, name, user, status, and payload.</dd>
        
        <dt>payload <span class="property-type">any</span></dt>
        <dd>The original payload from the API request.</dd>
        
        <dt>topic <span class="property-type">string</span></dt>
        <dd>Set to "task-package/{tp_id}/started".</dd>
    </dl>
    
    <h3>Configuration</h3>
    <dl class="message-properties">
        <dt>Auto Transition <span class="property-type">boolean</span></dt>
        <dd>
            If enabled, automatically transitions task status from 'started' to 'ongoing' after updating. 
            Useful for workflows where tasks immediately begin active execution.
        </dd>
    </dl>
    
    <h3>Flow Context</h3>
    <p>This node stores the following values in flow context for other task package nodes:</p>
    <ul>
        <li><code>current_tpc_id</code> - The generated task instance ID (UUID)</li>
        <li><code>current_tp_id</code> - The task package ID</li>
        <li><code>current_tp_name</code> - The task package name</li>
        <li><code>task_cancelled</code> - Cancellation flag (initially false)</li>
    </ul>
    
    <h3>Usage</h3>
    <p>
        Wire this node after your tp-create node and any custom validation logic. 
        This node will update the task package status from 'created' to 'started' in the database.
    </p>
    <p>
        The input message must contain tp_data.tpc_id for the node to update the correct task instance.
    </p>
</script>
