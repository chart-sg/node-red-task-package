<!-- Task Package Configuration Node HTML -->
<script type="text/javascript">
    // Isolate this code
    (function () {
        'use strict'

        const nodeLabel = 'tp-config'

        RED.nodes.registerType(nodeLabel, {
            category: 'config',
            color: '#EF9A9A',
            defaults: {
                name: { value: '' },
                keycloak_url: { value: '' },
                db_url: { value: '/tmp/sqlite' }
            },
            label: function () {
                return this.name || 'Config'
            },
            icon: 'tp.svg'
        })

    })()
</script>

<script type="text/html" data-template-name="tp-config">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Task Package Config">
    </div>
    
    <div class="form-row">
        <label for="node-config-input-keycloak_url"><i class="fa fa-key"></i> OIDC Provider URL (Optional)</label>
        <input type="text" id="node-config-input-keycloak_url" placeholder="http://10.233.0.80:8080/realms/chart-sandbox">
        <div class="form-tips">
            <strong>Optional:</strong> Complete OIDC provider URL for authentication.<br>
            <strong>Examples:</strong><br>
            • Keycloak: <code>http://host:8080/realms/realm-name</code><br>
            • Auth0: <code>https://your-domain.auth0.com</code><br>
            • Azure AD: <code>https://login.microsoftonline.com/tenant-id</code><br>
            • Okta: <code>https://your-domain.okta.com</code><br>
            • Google: <code>https://www.googleapis.com/oauth2/v1/userinfo</code><br>
            • AWS Cognito: <code>https://cognito-idp.region.amazonaws.com/user-pool-id</code>
        </div>
    </div>
    
    <div class="form-row">
        <label for="node-config-input-db_url"><i class="fa fa-database"></i> Database Path</label>
        <input type="text" id="node-config-input-db_url" placeholder="/tmp/sqlite">
        <div class="form-tips">
            Database file path for SQLite storage.
        </div>
    </div>
</script>

<script type="text/html" data-help-name="tp-config">
    <p>Global configuration node for the Task Package system.</p>
    
    <h3>Configuration</h3>
    <dl class="message-properties">
        <dt>Name <span class="property-type">string</span></dt>
        <dd>A descriptive name for this configuration.</dd>
        
        <dt>OIDC Provider URL <span class="property-type">string</span></dt>
        <dd>
            <b>Optional:</b> OIDC provider endpoint for authentication and authorization.
            If provided, task package requests will be validated against the OIDC provider.
            If empty, security is disabled (useful for development).
            <br><br>
            Supports multiple providers: Keycloak, Auth0, Azure AD, Okta, Google, AWS Cognito.
            The system will auto-detect the correct userinfo endpoint based on the provider URL.
            <br><br>
            Example: <code>http://10.233.0.80:8080/realms/chart-sandbox</code>
        </dd>
        
        <dt>Database Path <span class="property-type">string</span></dt>
        <dd>
            File path for the SQLite database that stores task package definitions and execution instances.
            <br><br>
            Default: <code>/tmp/sqlite</code>
        </dd>
    </dl>
    
    <h3>Usage</h3>
    <p>
        This configuration node must be referenced by task package nodes (tp-start, tp-cancel, etc.) 
        to provide system-wide settings. Only one configuration should be active per Node-RED instance.
    </p>
    
    <h3>Security</h3>
    <p>
        When OIDC Provider URL is configured, all task package API requests must include a valid Bearer token.
        The token will be validated against the OIDC provider, and the user's <code>tp_allowed</code> array will be 
        checked to ensure they have permission to execute the requested task package.
    </p>
    <p>
        When OIDC Provider URL is empty, all security checks are bypassed - useful for development and testing.
    </p>
</script>
